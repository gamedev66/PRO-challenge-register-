<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pok√©mon Revolution Online Grand Championship Registration</title>
    <!-- Load Tailwind CSS --><script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts for a more modern, slightly playful but strong feel --><link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&family=Poppins:wght@400;600;700;800;900&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Poppins', sans-serif; /* Modern, clean font */
            background: linear-gradient(135deg, #1e3a8a 0%, #172554 100%); /* Deep blue gradient */
            color: #e2e8f0; /* Light text for contrast */
            background-attachment: fixed;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 2rem;
            position: relative;
            overflow-x: hidden; /* Prevent horizontal scroll from pseudo-elements */
        }

        /* Subtle Pok√©mon-like background patterns */
        body::before, body::after {
            content: '';
            position: absolute;
            width: 300px;
            height: 300px;
            background-image: radial-gradient(circle, rgba(255, 255, 255, 0.05) 1px, transparent 1px);
            background-size: 20px 20px;
            pointer-events: none;
            z-index: 0;
            opacity: 0.3;
        }
        body::before {
            top: -50px;
            left: -50px;
            transform: rotate(45deg);
        }
        body::after {
            bottom: -50px;
            right: -50px;
            transform: rotate(225deg);
        }

        #app {
            z-index: 1; /* Keep content above background patterns */
        }

        /* Header Specific Styles */
        header {
            background: linear-gradient(180deg, #dc2626 0%, #b91c1c 100%); /* Strong red gradient */
            color: #fff;
            padding: 1.5rem 2.5rem;
            border-radius: 1.5rem; /* More rounded corners */
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.4);
            margin-bottom: 2.5rem;
            position: relative;
            overflow: hidden;
            border: 3px solid #fcd34d; /* Yellow border */
        }

        header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url('data:image/svg+xml;utf8,<svg width="100" height="100" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg"><circle cx="50" cy="50" r="40" stroke="%23fcd34d" stroke-width="2" fill="none"/></svg>') repeat;
            opacity: 0.1;
            z-index: 0;
        }

        header h1 {
            font-family: 'Press Start 2P', cursive; /* Retro game font */
            font-size: 4rem; /* Larger */
            color: #fcd34d; /* Yellow text */
            text-shadow: 4px 4px #000; /* Stronger shadow */
            line-height: 0.9;
        }

        header h2 {
            font-family: 'Poppins', sans-serif;
            font-size: 2.25rem; /* Adjusted for Poppins */
            color: #fff;
            margin-top: 0.5rem;
            border-bottom: none; /* Removed default border */
            padding-bottom: 0;
            position: relative;
            display: inline-block;
        }

        header h2::after {
            content: '';
            position: absolute;
            left: 50%;
            bottom: -10px;
            transform: translateX(-50%);
            width: 80%;
            height: 4px;
            background: linear-gradient(90deg, #fcd34d, #fed7aa, #fcd34d); /* Yellow-orange gradient */
            border-radius: 2px;
        }

        header p {
            font-size: 1.1rem;
            color: #fca5a5; /* Lighter red */
            margin-top: 1rem;
        }

        .event-info {
            background: rgba(255, 255, 255, 0.15); /* Slightly transparent white */
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 0.75rem;
            padding: 0.75rem 1.5rem;
            margin-top: 1.5rem;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
            font-weight: 600;
            color: #fcd34d; /* Yellow text */
        }

        .card {
            background-color: #2d3748; /* Darker blue-gray */
            border: 1px solid #4a5568; /* Slightly lighter border */
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.5); /* Stronger, darker shadow */
            border-radius: 1.25rem; /* More rounded */
            padding: 1.75rem;
        }

        .btn-primary {
            background: linear-gradient(90deg, #3b82f6, #2563eb); /* Original blue gradient */
            transition: all 0.3s ease;
            box-shadow: 0 6px 15px rgba(59, 130, 246, 0.5);
            color: white;
            font-weight: 700;
            border-radius: 0.75rem; /* Consistent rounding */
            padding: 0.9rem 1.5rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }
        .btn-primary:hover:not(:disabled) {
            background: linear-gradient(90deg, #2563eb, #1d4ed8);
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(59, 130, 246, 0.7);
        }
        .btn-primary:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            box-shadow: none;
        }

        /* New button style for download link */
        .btn-download {
            background: linear-gradient(90deg, #10b981, #059669); /* Green gradient */
            transition: all 0.3s ease;
            box-shadow: 0 6px 15px rgba(16, 185, 129, 0.5);
            color: white;
            font-weight: 700;
            border-radius: 0.75rem;
            padding: 0.9rem 1.5rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            text-decoration: none;
        }
        .btn-download:hover {
            background: linear-gradient(90deg, #059669, #047857);
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(16, 185, 129, 0.7);
        }

        .input-field {
            background-color: #4a5568; /* Darker input background */
            border: 1px solid #6b7280; /* Consistent dark border */
            color: #e2e8f0; /* Light text in inputs */
            padding: 0.8rem 1rem;
            border-radius: 0.6rem;
            transition: border-color 0.3s, box-shadow 0.3s;
        }
        .input-field::placeholder {
            color: #a0aec0; /* Lighter placeholder text */
        }
        .input-field:focus {
            outline: none;
            border-color: #fcd34d; /* Yellow focus border */
            box-shadow: 0 0 0 3px rgba(252, 211, 77, 0.4); /* Yellow glow */
        }
        .input-error {
            border-color: #ef4444 !important;
            box-shadow: 0 0 0 3px rgba(239, 68, 68, 0.5) !important;
        }

        .accent-text {
            color: #fcd34d; /* Yellow for accents */
        }

        .text-red-600 {
            color: #ef4444; /* Standard red for errors */
        }
        .bg-red-100 {
            background-color: #fee2e2;
        }
        .border-red-400 {
            border-color: #fca5a5;
        }

        .text-green-600 {
            color: #10b981; /* Green for success */
        }
        .bg-green-100 {
            background-color: #d1fae5;
        }
        .border-green-400 {
            border-color: #6ee7b7;
        }

        /* Registered Players List */
        #registrations-list {
            background-color: #1f2937; /* Even darker background for the list area */
            border-radius: 1rem;
            padding: 1rem;
            max-height: 70vh; /* Keep scrollable height */
            overflow-y: auto;
            border: 1px solid #374151;
        }
        #registrations-list::-webkit-scrollbar {
            width: 8px;
        }
        #registrations-list::-webkit-scrollbar-thumb {
            background-color: #fcd34d; /* Yellow scroll thumb */
            border-radius: 4px;
        }
        #registrations-list::-webkit-scrollbar-track {
            background: #4a5568; /* Dark scroll track */
        }

        #registrations-list > div { /* Individual player entries */
            background-color: #2d3748; /* Dark card background */
            border-radius: 0.75rem;
            margin-bottom: 0.75rem; /* Spacing between entries */
            padding: 1rem 1.25rem;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
            box-shadow: 0 4px 10px rgba(0,0,0,0.3);
            color: #e2e8f0; /* Light text */
            border: 1px solid #4a5568;
        }
        #registrations-list > div:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 15px rgba(0,0,0,0.4);
        }

        #registrations-list .bg-blue-50 { /* Current user highlight */
            background: linear-gradient(90deg, #3b82f6, #2563eb); /* Vibrant blue gradient */
            color: #fff;
            border: 3px solid #fcd34d; /* Yellow border for own entry */
            box-shadow: 0 6px 20px rgba(59, 130, 246, 0.6);
        }
        #registrations-list .bg-blue-50 .text-gray-500,
        #registrations-list .bg-blue-50 .text-gray-700,
        #registrations-list .bg-blue-50 .text-gray-400,
        #registrations-list .bg-blue-50 .text-gray-600 {
            color: #e0f2fe !important; /* Lighter text for contrast on blue background */
        }

        #no-players {
            color: #a0aec0; /* Lighter gray for no players message */
        }

        .loading-indicator {
            color: #fcd34d; /* Yellow loading text */
            font-weight: 600;
        }
        #auth-status, #user-id-display {
            color: #cbd5e0; /* Lighter gray for status messages */
        }
        .text-2xl.font-bold.mb-5.text-gray-800 { /* Form & List headings */
            color: #fcd34d; /* Yellow heading */
        }
        .text-gray-800 {
            color: #e2e8f0; /* Ensure headings are visible on dark cards */
        }
        label {
            color: #fcd34d; /* Yellow labels */
        }
    </style>
</head>
<body>

    <div id="app" class="min-h-screen flex flex-col items-center p-4 sm:p-8 relative z-10 w-full">
        <!-- Header --><header class="text-center max-w-4xl w-full">
            <h1 class="mb-1 uppercase">
                P.R.O.
            </h1>
            <h2 class="mb-4">
                GRAND CHAMPIONSHIP CHALLENGE
            </h2>
            <p class="text-lg mt-4 font-medium">
                Prove you're the very best. Register below to claim your spot in the ultimate tournament.
            </p>
            <div class="event-info inline-block">
                <p class="font-black text-lg tracking-wider flex items-center justify-center">
                    <span class="mr-3 text-2xl">üìÖ</span> Start Date: Tomorrow @ 7:00 PM (Race Begins) <span class="mx-4 text-gray-400">|</span> <span class="ml-3 mr-3 text-2xl">üí∞</span> Grand Prize: <span class="ml-1 text-yellow-300">500 Rs</span>
                </p>
            </div>
        </header>

        <!-- PRO Description and Download Link --><div id="pro-info" class="card max-w-4xl w-full mx-auto p-6 mt-4 mb-8">
            <h3 class="text-2xl font-extrabold text-green-400 mb-4 text-center border-b pb-2 border-gray-600">
                What is Pok√©mon Revolution Online?
            </h3>
            <div class="text-center">
                <p class="text-gray-300 mb-6 max-w-2xl mx-auto">
                    Pok√©mon Revolution Online (PRO) is a popular free-to-play massive multiplayer online Pok√©mon game. It features four classic regions (Kanto, Johto, Hoenn, and Sinnoh) and allows players to battle, trade, and explore a vast, interconnected world with thousands of other trainers. To compete in this championship, you must have an active PRO account.
                </p>
                <a href="https://pokemon-revolution-online.net/Download.php" target="_blank" class="btn-download">
                    <span class="mr-2 text-2xl">‚¨áÔ∏è</span> Download PRO Here
                </a>
            </div>
        </div>

        <!-- Tournament Details Section (UPDATED FOR BANS) --><div id="tournament-details" class="card max-w-4xl w-full mx-auto p-6 mt-4 mb-8">
            <h3 class="text-2xl font-extrabold accent-text mb-4 text-center border-b pb-2 border-gray-600">
                Tournament Rules: The Regional Race
            </h3>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 text-sm font-medium">
                
                <div class="p-4 bg-gray-700/50 rounded-lg shadow-inner">
                    <h4 class="font-bold text-lg mb-1 text-red-400 flex items-center">
                        <span class="mr-2">üèÜ</span> Format: The Race
                    </h4>
                    <p>A long-form, multi-stage race through 4 regions: Kanto $\rightarrow$ Johto $\rightarrow$ Hoenn $\rightarrow$ Sinnoh. Collective Progression is mandatory.
                    </p>
                </div>
                
                <div class="p-4 bg-gray-700/50 rounded-lg shadow-inner">
                    <h4 class="font-bold text-lg mb-1 text-red-400 flex items-center">
                        <span class="mr-2">üìù</span> Progression Rule
                    </h4>
                    <p>Once a player completes a region (e.g., Kanto), they must wait until all registered participants complete it before the entire group moves simultaneously to the next region (e.g., Johto).</p>
                </div>
                
                <div class="p-4 bg-gray-700/50 rounded-lg shadow-inner">
                    <h4 class="font-bold text-lg mb-1 text-red-400 flex items-center">
                        <span class="mr-2">‚öîÔ∏è</span> The Final Showdown
                    </h4>
                    <p>The first Trainers to successfully complete the Sinnoh region's story will enter a Single Elimination tournament bracket to determine the Grand Champion.</p>
                </div>
            </div>
            <div class="mt-4 text-center border-t pt-3 border-gray-600">
                <p class="text-base text-gray-300">
                    <span class="font-bold accent-text">Tier Restriction:</span> All Legendary and Mythical Pok√©mon (Uber tier) are strictly banned from this competition. Bring your strongest non-Legendary team!
                </p>
            </div>
        </div>

        <div id="loading-indicator" class="loading-indicator text-xl hidden mb-4">Loading competitor data...</div>
        <!-- This element is now used for both errors and success messages --><div id="error-message" class="font-bold mb-4 hidden p-4 bg-red-100 border border-red-400 rounded-xl text-center"></div>

        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8 max-w-7xl w-full">
            
            <!-- Registration Form (Column 1) --><div class="lg:col-span-1 h-fit lg:sticky top-8 space-y-6">
                
                <!-- Registration Form --><div class="card p-6">
                    <h2 class="text-2xl font-bold mb-5 flex items-center">
                        <span class="mr-2 text-red-500 text-3xl">‚ö°</span> Trainer Registration
                    </h2>
                    <form id="registration-form" class="space-y-5">
                        
                        <div>
                            <label for="player-name" class="block text-sm font-semibold mb-1">Full Name (Real Name - Required)</label>
                            <input type="text" id="player-name" required class="input-field w-full" placeholder="Your Real Name (e.g., Ash Ketchum)">
                        </div>
                        
                        <div>
                            <label for="gamertag" class="block text-sm font-semibold mb-1">PRO Trainer Name (Account Name - Required)</label>
                            <input type="text" id="gamertag" required class="input-field w-full" placeholder="Your In-Game Trainer Name">
                        </div>

                        <button type="submit" id="submit-btn" class="btn-primary w-full shadow-lg hover:shadow-xl">
                            <span id="submit-text" class="flex items-center justify-center">
                                <span class="mr-2">REGISTER FOR THE CHALLENGE</span>
                                <div class="w-4 h-4 rounded-full border-2 border-white/50 border-t-white animate-spin hidden" id="submit-spinner-icon"></div>
                            </span>
                        </button>
                        
                        <!-- Removed: Network status and internal ID displays -->
                    </form>
                    
                </div>
            </div>


            <!-- Registered Players List (Column 2 & 3) --><div class="lg:col-span-2 card p-6">
                <h2 class="text-2xl font-bold mb-5 flex justify-between items-center">
                    Current Competitors <span class="text-sm font-normal text-gray-400 ml-2">(Live Feed)</span>
                    <span id="player-count" class="accent-text text-3xl font-black">0</span>
                </h2>
                
                <div id="registrations-list" class="space-y-3 pr-2">
                    <p id="no-players" class="italic text-center py-12">No trainers registered yet. Be the first to start your journey!</p>
                </div>
            </div>

        </div>
    </div>

    <!-- Firebase SDK Imports --><script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, onSnapshot, collection, query, serverTimestamp, setDoc } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        
        // Global Firebase variables provided by the Canvas environment
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
        const firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : null;
        const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null; 

        let db, auth, userId = null;
        let isAuthReady = false;
        
        // --- UI Element References ---
        const errorEl = document.getElementById('error-message');
        const loadingEl = document.getElementById('loading-indicator');
        const submitSpinner = document.getElementById('submit-spinner-icon');
        const registrationForm = document.getElementById('registration-form');

        const inputName = document.getElementById('player-name');
        const inputGamertag = document.getElementById('gamertag');

        function displayError(message, isSuccess = false) {
            errorEl.textContent = isSuccess ? `Success! ${message}` : `Error: ${message}`;
            errorEl.classList.remove('hidden', 'bg-red-100', 'border-red-400', 'bg-green-100', 'border-green-400', 'text-red-600', 'text-green-600');
            
            if (isSuccess) {
                errorEl.classList.add('bg-green-100', 'border-green-400', 'text-green-600');
            } else {
                errorEl.classList.add('bg-red-100', 'border-red-400', 'text-red-600');
            }
            
            errorEl.classList.remove('hidden');
            console.log(isSuccess ? "Success: " + message : "Error: " + message);
            
            setTimeout(() => errorEl.classList.add('hidden'), isSuccess ? 7000 : 5000);
        }
        
        function setButtonLoading(isLoading) {
            const button = document.getElementById('submit-btn');
            const textSpan = document.getElementById('submit-text').querySelector('span:first-child'); 
            
            button.disabled = isLoading;
            if (isLoading) {
                textSpan.textContent = 'REGISTERING...';
                submitSpinner.classList.remove('hidden');
            } else {
                textSpan.textContent = 'REGISTER FOR THE CHALLENGE';
                submitSpinner.classList.add('hidden');
            }
        }
        
        function validateForm() {
            let isValid = true;
            const requiredFields = [inputName, inputGamertag];

            requiredFields.forEach(field => {
                const isFieldValid = field.value && field.value.trim() !== '';

                if (!isFieldValid) {
                    field.classList.add('input-error');
                    isValid = false;
                } else {
                    field.classList.remove('input-error');
                }
            });

            if (!isValid) {
                displayError("Please fill out all required fields marked in red.");
            }
            return isValid;
        }
        
        function clearFormFields() {
            inputName.value = '';
            inputGamertag.value = '';
            [inputName, inputGamertag].forEach(el => el.classList.remove('input-error'));
        }

        async function initializeFirebase() {
            if (!firebaseConfig) {
                displayError("Firebase configuration is missing.");
                return;
            }
            
            try {
                const app = initializeApp(firebaseConfig);
                db = getFirestore(app);
                auth = getAuth(app);
                
                if (initialAuthToken) {
                    await signInWithCustomToken(auth, initialAuthToken);
                } else {
                    await signInAnonymously(auth);
                }

                onAuthStateChanged(auth, (user) => {
                    if (user) {
                        userId = user.uid;
                        isAuthReady = true;
                        // Status update is now console-only
                        console.log(`[AUTH] Network Status: Logged in. Internal Trainer ID: ${userId}`);
                        
                        startRealtimeListener(); 
                    } else {
                        isAuthReady = false;
                        userId = null;
                         // Status update is now console-only
                        console.error('[AUTH] Authentication failed. Network offline.');
                    }
                });

            } catch (e) {
                displayError("Failed to initialize Firebase or authenticate: " + e.message);
            }
        }

        async function registerPlayer(event) {
            event.preventDefault();
            
            if (!isAuthReady || !userId || !db) {
                displayError("Trainer Network not ready. Please wait.");
                return;
            }

            if (!validateForm()) {
                return;
            }

            setButtonLoading(true);

            const playerName = inputName.value.trim();
            const gamertag = inputGamertag.value.trim();

            try {
                const registrationRef = collection(db, `artifacts/${appId}/public/data/proChampionshipRegistrations`);
                const registrationDocRef = doc(registrationRef, userId); 

                const data = {
                    userId: userId,
                    name: playerName,
                    gamertag: gamertag,
                    registeredAt: serverTimestamp(),
                };

                await setDoc(registrationDocRef, data);
                // Removed the mockExternalService call

                displayError(`Welcome, ${gamertag}! Your registration is complete. You are now locked in for the Grand Championship Challenge!`, true);

            } catch (e) {
                displayError("Registration failed. Error: " + e.message);
            } finally {
                setButtonLoading(false);
            }
        }
        
        function startRealtimeListener() {
            if (!db || !isAuthReady) return;
            
            const listEl = document.getElementById('registrations-list');
            const noPlayersEl = document.getElementById('no-players');
            const countEl = document.getElementById('player-count');
            
            const collectionPath = `artifacts/${appId}/public/data/proChampionshipRegistrations`;
            const q = query(collection(db, collectionPath));

            loadingEl.classList.remove('hidden');
            listEl.innerHTML = '';
            
            onSnapshot(q, (querySnapshot) => {
                loadingEl.classList.add('hidden');
                const players = [];
                querySnapshot.forEach((doc) => {
                    players.push({ id: doc.id, ...doc.data() });
                });

                players.sort((a, b) => (b.registeredAt?.seconds || 0) - (a.registeredAt?.seconds || 0));

                const isRegistered = players.some(p => p.id === userId);
                updateRegistrationFormUI(isRegistered, players.find(p => p.id === userId));

                renderPlayers(players, listEl, countEl, noPlayersEl);

            }, (error) => {
                loadingEl.classList.add('hidden');
                displayError("Failed to load real-time competitor data: " + error.message);
            });
        }
        
        function updateRegistrationFormUI(isRegistered, currentPlayerRegistration) {
            const formInputs = registrationForm.querySelectorAll('input, select');
            const submitBtn = document.getElementById('submit-btn');
            
            if (isRegistered && currentPlayerRegistration) {
                formInputs.forEach(el => el.disabled = true);
                inputName.value = currentPlayerRegistration.name;
                inputGamertag.value = currentPlayerRegistration.gamertag;
                
                submitBtn.classList.add('hidden');
            } else {
                formInputs.forEach(el => el.disabled = false);
                clearFormFields(); 

                submitBtn.classList.remove('hidden');
            }
        }

        function renderPlayers(players, listEl, countEl, noPlayersEl) {
            listEl.innerHTML = '';
            countEl.textContent = players.length;

            if (players.length === 0) {
                noPlayersEl.classList.remove('hidden');
                listEl.appendChild(noPlayersEl);
                return;
            }

            noPlayersEl.classList.add('hidden');

            players.forEach(player => {
                const playerEl = document.createElement('div');
                const isCurrentUser = player.id === userId;
                playerEl.className = 'flex flex-col sm:flex-row justify-between items-start sm:items-center p-3 rounded-lg border-b border-gray-100 transition duration-300 ' + 
                                     (isCurrentUser ? 'bg-blue-50 border-blue-200 border-2 shadow-sm' : 'hover:bg-gray-50');

                let timeStr = 'N/A';
                if (player.registeredAt && player.registeredAt.toDate) {
                    timeStr = player.registeredAt.toDate().toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit', hour12: true });
                }

                // Removed userId from the visible player list item here as well for a cleaner display
                playerEl.innerHTML = `
                    <div class="flex flex-col mb-2 sm:mb-0">
                        <span class="text-2xl font-bold accent-text">${player.gamertag} ${isCurrentUser ? '(You)' : ''}</span>
                        <span class="text-sm mt-1 flex items-center">
                            Real Name: 
                            <strong class="font-bold ml-1">
                                ${player.name} 
                            </strong> 
                        </span>
                    </div>
                    <div class="flex flex-col items-end sm:text-right">
                        <span class="text-xs italic">Registered at ${timeStr}</span>
                    </div>
                `;
                
                listEl.appendChild(playerEl);
            });
        }
        
        document.addEventListener('DOMContentLoaded', () => {
            initializeFirebase();
            registrationForm.addEventListener('submit', registerPlayer);
        });

    </script>

</body>
</html>


